<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="FilmFinder.FilmLibrary"
             Title="Film Kütüphanesi">

    <Grid RowDefinitions="*">

        <CollectionView x:Name="LibraryList" 
                        Grid.Row="0"
                        VerticalScrollBarVisibility="Always">
            
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" 
                                 Span="{OnIdiom Phone=3, Tablet=5}" 
                                 HorizontalItemSpacing="{OnIdiom Phone=2, Tablet=10}" 
                                 VerticalItemSpacing="{OnIdiom Phone=5, Tablet=15}" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <ContentView Padding="{OnIdiom Phone=3, Tablet=8}"> 
                        <Frame CornerRadius="10" 
                               HasShadow="False" 
                               BorderColor="#E0E0E0"
                               BackgroundColor="White"
                               Padding="0" 
                               IsClippedToBounds="True"
                               HeightRequest="{OnIdiom Phone=290, Tablet=380}">
                            
                            <Grid RowDefinitions="*, Auto">
                                <Grid Grid.Row="0">
                                    <Image Source="{Binding ImagePath}"
                                           Aspect="AspectFill"
                                           VerticalOptions="Fill"
                                           HorizontalOptions="Fill"/>
                                    
                                    <Image Source="watched.png" 
                                           IsVisible="{Binding IsWatched}"
                                           WidthRequest="{OnIdiom Phone=24, Tablet=32}" 
                                           HeightRequest="{OnIdiom Phone=24, Tablet=32}"
                                           HorizontalOptions="End" 
                                           VerticalOptions="Start"
                                           Margin="8"
                                           Shadow="{Shadow Brush=Black, Offset='1,1', Radius=2, Opacity=0.5}"/>
                                </Grid>

                                <VerticalStackLayout Grid.Row="1" Padding="5" Spacing="2" BackgroundColor="White">
                                    <Label Text="{Binding Name}" 
                                           FontSize="{OnIdiom Phone=13, Tablet=18}"
                                           FontAttributes="Bold"
                                           TextColor="Black"
                                           HorizontalTextAlignment="Center"
                                           MaxLines="2"
                                           LineBreakMode="TailTruncation"
                                           HeightRequest="{OnIdiom Phone=40, Tablet=50}"
                                           VerticalTextAlignment="Center"/>
                    
                                    <Button Text="İncele"
                                            FontSize="{OnIdiom Phone=11, Tablet=15}"
                                            HeightRequest="{OnIdiom Phone=30, Tablet=40}" 
                                            BackgroundColor="Transparent"
                                            TextColor="#6509b5"
                                            FontAttributes="Bold"
                                            CommandParameter="{Binding .}" 
                                            Clicked="OnFilmTapped" />
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </ContentView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <BoxView x:Name="BackgroundOverlay"
                 BackgroundColor="Black"
                 Opacity="0"
                 IsVisible="False"
                 ZIndex="10">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnCloseDetailClicked" />
            </BoxView.GestureRecognizers>
        </BoxView>
        
        <Frame x:Name="DetailPanel"
               BackgroundColor="White"
               CornerRadius="20"
               Margin="20"
               Padding="20"
               IsVisible="False" 
               WidthRequest="{OnIdiom Phone=320, Tablet=550}"
               VerticalOptions="Center"
               HorizontalOptions="Center"
               HasShadow="True"
               BorderColor="#6509b5"
               ZIndex="11">
    
            <VerticalStackLayout Spacing="15">
                <Image x:Name="FilmPoster"
                       Aspect="AspectFill"
                       HeightRequest="{OnIdiom Phone=220, Tablet=380}"
                       WidthRequest="{OnIdiom Phone=140, Tablet=250}"
                       HorizontalOptions="Center"/>
                
                <Label x:Name="DetailName" 
                       FontSize="{OnIdiom Phone=22, Tablet=34}" 
                       FontAttributes="Bold" 
                       HorizontalTextAlignment="Center"
                       TextColor="Black"/>

                <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                    <Label x:Name="DetailMood" TextColor="Gray" FontSize="{OnIdiom Phone=12, Tablet=18}"/>
                    <Label Text="|" TextColor="LightGray"/>
                    <Label x:Name="DetailTheme" TextColor="Gray" FontSize="{OnIdiom Phone=12, Tablet=18}"/>
                    <Label Text="|" TextColor="LightGray"/>
                    <Label x:Name="DetailTime" TextColor="Gray" FontSize="{OnIdiom Phone=12, Tablet=18}"/>
                </HorizontalStackLayout>
                
                <HorizontalStackLayout Spacing="15" HorizontalOptions="Center" Margin="0,10">
                    <Label Text="Bunu izledin mi?" VerticalOptions="Center" FontSize="{OnIdiom Phone=15, Tablet=22}"/>
                    <ImageButton x:Name="WatchStatusBtn" 
                                 HeightRequest="{OnIdiom Phone=35, Tablet=50}" 
                                 WidthRequest="{OnIdiom Phone=35, Tablet=50}" 
                                 Source="unwatched.png" 
                                 Clicked="OnWatchStatusClicked"/>
                </HorizontalStackLayout>

                <Button Text="Kapat" 
                        BackgroundColor="#6509b5" 
                        TextColor="White"
                        Clicked="OnCloseDetailClicked" 
                        CornerRadius="12"
                        HeightRequest="{OnIdiom Phone=50, Tablet=70}"
                        FontSize="{OnIdiom Phone=16, Tablet=22}"/>
            </VerticalStackLayout>
        </Frame>
    </Grid>
</ContentPage>